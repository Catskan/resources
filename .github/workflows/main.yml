#Github Action to run the Debian-Ansible container and start Ansible to manager targets

on:
  workflow_dispatch:
    inputs:
      python_version:
        type: string
        description: Python Version you want to use in the Debian-Ansible container
        required: true

  
jobs:
  start-ansible:
    name: run ansible container
    runs-on: self-hosted
    
    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: Show the OS
        run: echo $GITHUB_WORKSPACE

      - name: Start docker on macOS
        if: runner.os == 'macOS'
        run: open -a docker && sleep 10


      - name: "Ensure docker daemon is running on Linux"
        if: runner.os == 'Linux'
        run: |
            until [ $(systemctl is-active containerd docker) = active ]
              do
                systemctl start containerd docker
                sleep 3;
              done
            echo -e "Service Containerd & Docker are started and active"
        
      - name: Build and push Debian-Ansible image
        # You may pin to the exact commit or the version.
        # uses: docker/build-push-action@37abcedcc1da61a57767b7588cb9d03eb57e28b3
        uses: docker/build-push-action@v3.3.0
        with:
          file: ${{ github.workspace }}/Containers/Linux/Debian-Ansible/Ansible.dockerfile
          push: false
          tags: catskan.dockerhub.io/debian-ansible:v1
          context: .
          build-args: python_version=3.11.1